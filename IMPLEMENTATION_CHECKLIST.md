# Flutter POSアプリ実装手順書（チェックリスト付き）

## プロジェクト概要
- **目標**: Next.js版POSアプリをFlutterで再実装
- **段階的実装**: 基本機能 → バックエンド接続 → バーコードスキャン機能
- **開発管理**: Git による細かなバージョン管理

## フェーズ1: プロジェクト基盤構築

### 1.1 プロジェクトセットアップ
- [x] Flutterプロジェクトの作成 ✓ 完了
- [x] 必要なパッケージの追加（pubspec.yaml） ✓ 完了
- [x] 基本的なディレクトリ構成の作成 ✓ 完了
- [x] 初期コミット（プロジェクト基盤） ✓ 完了

### 1.2 データモデル定義
- [x] `lib/models/product.dart` - 商品データモデル ✓ 完了
- [x] `lib/models/purchase_item.dart` - 購入商品データモデル ✓ 完了
- [x] `lib/models/transaction.dart` - 取引データモデル ✓ 完了
- [x] コミット（データモデル定義） ✓ 完了

### 1.3 設定・定数ファイル
- [x] `lib/config/app_config.dart` - アプリ設定 ✓ 完了
- [x] `lib/utils/constants.dart` - 定数定義 ✓ 完了
- [x] コミット（設定・定数ファイル） ✓ 完了

## フェーズ2: 基本UI実装

### 2.1 テーマ・スタイル設定
- [x] `lib/main.dart` - アプリエントリポイント ✓ 完了
- [x] Material Design 3 テーマ設定 ✓ 完了
- [x] カスタムカラーパレット定義 ✓ 完了
- [x] コミット（テーマ設定） ✓ 完了

### 2.2 メインPOS画面の基本構造
- [x] `lib/screens/pos_screen.dart` - メインPOS画面 ✓ 完了
- [x] 基本的なレイアウト構造 ✓ 完了
- [x] 商品検索入力フィールド ✓ 完了
- [x] コミット（メインPOS画面基本構造） ✓ 完了

### 2.3 商品検索ウィジェット
- [x] `lib/widgets/product_search_widget.dart` - 商品検索ウィジェット ✓ 完了
- [x] 商品コード入力フィールド ✓ 完了
- [x] 検索ボタン ✓ 完了
- [x] 商品情報表示エリア ✓ 完了
- [x] コミット（商品検索ウィジェット） ✓ 完了

### 2.4 購入リストウィジェット
- [x] `lib/widgets/purchase_list_widget.dart` - 購入リストウィジェット ✓ 完了
- [x] 商品リスト表示 ✓ 完了
- [x] 数量調整ボタン ✓ 完了
- [x] 商品削除ボタン ✓ 完了
- [x] 合計金額表示 ✓ 完了
- [x] コミット（購入リストウィジェット） ✓ 完了

### 2.5 共通ウィジェット
- [x] `lib/widgets/custom_button.dart` - カスタムボタン ✓ 完了
- [x] `lib/widgets/loading_indicator.dart` - ローディングインジケーター ✓ 完了
- [x] `lib/widgets/error_dialog.dart` - エラーダイアログ ✓ 完了
- [x] コミット（共通ウィジェット） ✓ 完了

## フェーズ3: 状態管理実装

### 3.1 Provider セットアップ
- [x] `lib/providers/pos_provider.dart` - POSアプリの状態管理 ✓ 完了
- [x] 商品検索状態の定義 ✓ 完了
- [x] 購入リスト状態の定義 ✓ 完了
- [x] エラー・ローディング状態の定義 ✓ 完了
- [x] コミット（状態管理基盤） ✓ 完了

### 3.2 状態管理ロジック
- [x] 商品検索ロジック（モック実装） ✓ 完了
- [x] 購入リスト操作ロジック ✓ 完了
- [x] 数量調整ロジック ✓ 完了
- [x] 商品削除ロジック ✓ 完了
- [x] 合計金額計算ロジック ✓ 完了
- [x] コミット（状態管理ロジック） ✓ 完了

### 3.3 UI と状態管理の連携
- [x] POS画面でのProvider利用 ✓ 完了
- [x] 商品検索ウィジェットでの状態連携 ✓ 完了
- [x] 購入リストウィジェットでの状態連携 ✓ 完了
- [x] コミット（UI状態管理連携） ✓ 完了

## フェーズ4: モック実装での動作確認

### 4.1 モックデータ作成
- [x] `lib/data/mock_products.dart` - モック商品データ ✓ 完了
- [x] 商品検索のモック実装 ✓ 完了
- [x] 購入処理のモック実装 ✓ 完了
- [x] コミット（モック実装） ✓ 完了

### 4.2 動作確認
- [x] アプリケーションの起動確認 ✓ 完了
- [x] 商品検索機能の動作確認 ✓ 完了
- [x] 購入リスト操作の動作確認 ✓ 完了
- [x] 数量調整機能の動作確認 ✓ 完了
- [x] 商品削除機能の動作確認 ✓ 完了
- [x] 合計金額計算の動作確認 ✓ 完了
- [x] コミット（基本機能動作確認） ✓ 完了

## フェーズ5: バックエンドAPI連携

### 5.1 HTTP通信サービス
- [x] `lib/services/api_service.dart` - API通信サービス ✓ 完了
- [x] HTTP Client の設定 ✓ 完了
- [x] API エンドポイントの定義 ✓ 完了
- [x] エラーハンドリング ✓ 完了
- [x] コミット（API通信サービス） ✓ 完了

### 5.2 商品検索API連携
- [x] `GET /products/{code}` の実装 ✓ 完了
- [x] 商品検索のAPI連携 ✓ 完了
- [x] エラーレスポンス処理 ✓ 完了
- [x] 「商品がマスタ未登録です」対応 ✓ 完了
- [x] コミット（商品検索API連携） ✓ 完了

### 5.3 購入処理API連携
- [x] `POST /purchase` の実装 ✓ 完了
- [x] 購入データの送信 ✓ 完了
- [x] レスポンス処理 ✓ 完了
- [x] エラーハンドリング ✓ 完了
- [x] コミット（購入処理API連携） ✓ 完了

### 5.4 バックエンド接続テスト
- [x] pos-app-backend の起動確認 ✓ 完了
- [x] Flutter アプリからの商品検索テスト ✓ 完了
- [x] Flutter アプリからの購入処理テスト ✓ 完了
- [x] エラーケースの動作確認 ✓ 完了
- [x] コミット（バックエンド接続テスト完了） ✓ 完了

## フェーズ6: 税金計算・表示機能

### 6.1 税金計算ロジック
- [x] `lib/utils/tax_calculator.dart` - 税金計算ユーティリティ ✓ 完了
- [x] 税込・税抜金額計算 ✓ 完了
- [x] 消費税計算 ✓ 完了
- [x] コミット（税金計算ロジック） ✓ 完了

### 6.2 税金表示モーダル
- [x] `lib/widgets/tax_modal_widget.dart` - 税金表示モーダル ✓ 完了
- [x] 税抜金額表示 ✓ 完了
- [x] 消費税表示 ✓ 完了
- [x] 税込合計表示 ✓ 完了
- [x] コミット（税金表示モーダル） ✓ 完了

### 6.3 購入完了画面
- [x] `lib/screens/purchase_complete_screen.dart` - 購入完了画面 ✓ 完了
- [x] 購入成功メッセージ ✓ 完了
- [x] 税金情報表示 ✓ 完了
- [x] 新規取引ボタン ✓ 完了
- [x] コミット（購入完了画面） ✓ 完了

## フェーズ7: APIキー認証実装

### 7.1 APIキー認証システム設計
- [x] APIキー認証の仕様策定 ✓ 完了
- [x] セキュリティ要件の定義 ✓ 完了
- [x] エラーハンドリング設計 ✓ 完了
- [x] コミット（APIキー認証設計） ✓ 完了

### 7.2 バックエンド側実装（pos-app-backend-supabase）
- [ ] FastAPIにAPIキー認証ミドルウェアを追加
- [ ] CORS設定の更新（ネイティブアプリ対応）
- [ ] 認証エラーレスポンスの実装
- [ ] APIキー設定の環境変数化
- [ ] コミット（バックエンドAPIキー認証）

### 7.3 Flutter側実装
- [ ] ApiServiceクラスにAPIキーヘッダー追加
- [ ] 認証エラーハンドリングの実装
- [ ] 設定画面でのAPI URL切り替え機能
- [ ] エラーメッセージの日本語化
- [ ] コミット（FlutterAPIキー認証）

### 7.4 動作確認・テスト
- [ ] ローカル環境でのAPIキー認証テスト
- [ ] Web/Android/Linux全プラットフォーム動作確認
- [ ] 認証エラーケースの動作確認
- [ ] パフォーマンステスト
- [ ] コミット（APIキー認証テスト完了）

### 7.5 Next.js側対応
- [ ] Next.jsアプリにAPIキー認証を追加
- [ ] 環境変数でのAPIキー管理
- [ ] エラーハンドリングの統一
- [ ] コミット（Next.jsAPIキー認証）

### 7.6 Azure本番環境デプロイ
- [ ] pos-app-backendにAPIキー認証をデプロイ
- [ ] 本番環境でのAPIキー設定
- [ ] 全環境での動作確認
- [ ] コミット（本番環境APIキー認証）

## フェーズ8: エラーハンドリング・UX改善

### 8.1 エラーハンドリング強化
- [ ] ネットワークエラーの適切な処理
- [ ] タイムアウト処理
- [ ] ユーザーフレンドリーなエラーメッセージ
- [ ] リトライ機能
- [ ] コミット（エラーハンドリング強化）

### 8.2 UX改善
- [ ] ローディング状態の表示
- [ ] 適切なフィードバック
- [ ] バリデーション機能
- [ ] キーボード操作対応
- [ ] コミット（UX改善）

### 8.3 レスポンシブデザイン
- [ ] タブレット対応
- [ ] 様々な画面サイズへの対応
- [ ] 横向き表示対応
- [ ] コミット（レスポンシブデザイン）

## フェーズ9: バーコードスキャン機能実装

### 9.1 カメラ権限設定
- [ ] `android/app/src/main/AndroidManifest.xml` - Android カメラ権限
- [ ] `ios/Runner/Info.plist` - iOS カメラ権限
- [ ] 権限要求処理の実装
- [ ] コミット（カメラ権限設定）

### 9.2 バーコードスキャンサービス
- [ ] `lib/services/barcode_service.dart` - バーコードスキャンサービス
- [ ] mobile_scanner パッケージの利用
- [ ] カメラ制御ロジック
- [ ] バーコード読み取り処理
- [ ] コミット（バーコードスキャンサービス）

### 9.3 バーコードスキャン画面
- [ ] `lib/screens/barcode_scanner_screen.dart` - バーコードスキャン画面
- [ ] カメラプレビュー表示
- [ ] 読み取り結果処理
- [ ] 手動入力への切り替え
- [ ] コミット（バーコードスキャン画面）

### 9.4 バーコードスキャン連携
- [ ] メインPOS画面からのスキャン起動
- [ ] 読み取り結果の自動商品検索
- [ ] エラーハンドリング
- [ ] コミット（バーコードスキャン連携）

## フェーズ10: テスト・品質保証

### 10.1 単体テスト
- [ ] `test/models/` - データモデルテスト
- [ ] `test/services/` - サービスクラステスト
- [ ] `test/utils/` - ユーティリティテスト
- [ ] コミット（単体テスト）

### 10.2 ウィジェットテスト
- [ ] `test/widgets/` - ウィジェットテスト
- [ ] `test/screens/` - 画面テスト
- [ ] コミット（ウィジェットテスト）

### 10.3 統合テスト
- [ ] `integration_test/` - 統合テスト
- [ ] API連携テスト
- [ ] エンドツーエンドテスト
- [ ] コミット（統合テスト）

### 10.4 パフォーマンステスト
- [ ] アプリ起動時間の測定
- [ ] メモリ使用量の確認
- [ ] バッテリー使用量の確認
- [ ] コミット（パフォーマンステスト）

## フェーズ11: デプロイメント・運用準備

### 11.1 ビルド設定
- [ ] Android リリースビルド設定
- [ ] iOS リリースビルド設定
- [ ] 署名・証明書設定
- [ ] コミット（ビルド設定）

### 11.2 アプリアイコン・スプラッシュスクリーン
- [ ] アプリアイコン作成
- [ ] スプラッシュスクリーン作成
- [ ] 各解像度対応
- [ ] コミット（アプリアイコン・スプラッシュ）

### 11.3 ドキュメント整備
- [ ] README.md の作成
- [ ] API仕様書の作成
- [ ] セットアップ手順書の作成
- [ ] コミット（ドキュメント整備）

### 11.4 最終確認
- [ ] 全機能の動作確認
- [ ] エラーケースの確認
- [ ] パフォーマンス確認
- [ ] コミット（最終確認完了）

## Git ブランチ戦略

### ブランチ構造
- `main` - 安定版・リリース用
- `develop` - 開発版統合
- `feature/*` - 機能開発用
- `hotfix/*` - 緊急修正用

### 推奨コミット規則
- **feat**: 新機能追加
- **fix**: バグ修正
- **refactor**: リファクタリング
- **test**: テスト追加・修正
- **docs**: ドキュメント更新
- **style**: コードスタイル修正

### 例: コミットメッセージ
```
feat: 商品検索ウィジェットを実装

- 商品コード入力フィールドを追加
- 検索ボタンの実装
- 商品情報表示エリアを作成
```

## 開発環境設定

### 必要な環境
- Flutter SDK (3.x以上)
- Android Studio / VS Code
- Git
- 実機またはエミュレーター

### 推奨開発フロー
1. 機能ブランチの作成
2. 実装
3. 動作確認
4. コミット・プッシュ
5. developブランチへマージ
6. 統合テスト
7. mainブランチへマージ

## 進捗管理

### 進捗状況の記録
- [ ] 完了したタスクには日付を記録
- [ ] 問題発生時はissueを作成
- [ ] 定期的な進捗レビュー

### 完了基準
- [ ] 全ての機能が正常に動作
- [ ] テストが通過
- [ ] コードレビューが完了
- [ ] ドキュメントが整備

---
**開始日**: ____/____/____
**完了予定日**: ____/____/____
**実完了日**: ____/____/____